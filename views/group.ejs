<%- include('partials/header') %>

<div class="container mt-5">
    <!-- Button trigger modal -->


    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createGroupModal">
        Create Group
    </button>

    <% if (typeof message != 'undefined') { %>
        <p class="message-success" id="successMessage"><%= message %></p>
    <% } %>

    <!-- Group List Table -->
    <table class="table table-striped table-hover mt-4">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Sr.No</th>
                <th scope="col">Image</th>
                <th scope="col">Name</th>
                <th scope="col">Limit</th>
                <th scope="col">Members</th>
                <th scope="col">Action</th>
            </tr>
        </thead>

        <tbody>
            <% if (groups.length > 0) { 
                for (let i = 0; i < groups.length; i++) { %>
                    <tr>
                        <td class="align-middle"><%= i + 1 %></td>
                        <td class="align-middle">
                            <img src="<%= groups[i]['image'] %>" alt="Group Image" class="img-fluid rounded-circle" style="width: 100px; height: 100px; object-fit: cover;">
                        </td>
                        <td class="align-middle"><%= groups[i]['name'] %></td>
                        <td class="align-middle"><%= groups[i]['limit'] %></td>
                        <td class="align-middle">
                            <a  class="btn btn-sm btn-outline-info cursor-pointer addMember" data-id="<%=groups[i]['_id']%>" data-limit="<%= groups[i]['limit'] %>" data-toggle="modal" data-target="#addMemberModal">View Members</a>
                        </td>
                        <td class="align-middle">
                            <!-- Add group actions here like 'Edit' or 'Delete' -->
                            <button class="btn btn-sm btn-outline-danger">Delete</button>
                        </td>
                    </tr>
                <% } 
            } else { %>
                <tr>
                    <td colspan="6" class="text-center">No Groups Found!</td>
                </tr>
            <% } %>
        </tbody>
    </table>

 <!-- Modal -->
 <div class="modal fade" id="createGroupModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-white" id="exampleModalLongTitle">Create Group</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form enctype="multipart/form-data" method="POST">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="groupName" class="modal-label">Group Name</label>
                        <input type="text" id="groupName" class="form-control" name="name" placeholder="Enter group name" required>
                    </div>
                    <div class="form-group">
                        <label for="groupImage" class="modal-label">Group Image</label>
                        <input type="file" id="groupImage" class="form-control-file" name="image" required>
                    </div>
                    <div class="form-group">
                        <label for="groupLimit" class="modal-label">Member Limit</label>
                        <input type="number" id="groupLimit" class="form-control" name="limit" placeholder="Enter Group member limit" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </div>
            </form>
        </div>
    </div>
</div>
</div>

    <!-- Members Modal -->
<div class="modal fade" id="addMemberModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-white" id="exampleModalLongTitle">Add Members</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="add-member-form" method="POST">
                <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                    <!-- Hidden inputs -->
                    <input type="hidden" id="group_id" name="group_id">
                    <input type="hidden" name="limit" id="limit">
                    
                    <!-- Member Table -->
                    <table class="table table-striped table-hover add-member-table">
                        <thead class="thead-dark">
                            <tr>
                                <th>Select</th>
                                <th>Name</th>
                            </tr>
                        </thead>
                        <tbody class="addMemberTable">
                            <!-- Dynamic content goes here -->
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Update Members</button>
                </div>
            </form>
        </div>
    </div>
</div>


<script>
    $(document).ready(function() {
        // Check if the success message exists
        if ($('#successMessage').length) {
            // Hide the message after 3 seconds (3000 milliseconds)
            setTimeout(function() {
                $('#successMessage').fadeOut('slow');
            }, 3000);
        }
    });
</script>

<%- include('partials/footer') %>